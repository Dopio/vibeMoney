import pyautogui
import time
import json


def test_all_coordinates():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –≤—Å–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞"""
    print("üéØ –ó–ê–ü–£–°–ö –¢–ï–°–¢–ê –ö–û–û–†–î–ò–ù–ê–¢")
    print("=" * 50)

    # –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ –≤–∞—à–µ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞
    coordinates = [
        [1984, 247], [2084, 247], [2184, 247], [2284, 247], [2384, 247], [2484, 247],
        [1984, 445], [2084, 445], [2184, 445], [2284, 445], [2384, 445], [2484, 445],
        [1984, 643], [2084, 643], [2184, 643], [2284, 643], [2384, 643], [2484, 643]
    ]

    print(f"üîß –í—Å–µ–≥–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç: {len(coordinates)}")
    print("üîß –ù–∞–≤–µ–¥–∏—Ç–µ –∫—É—Ä—Å–æ—Ä –Ω–∞ –æ–∫–Ω–æ PoE –∏ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –Ω–∞—á–Ω–µ—Ç—Å—è —Ç–µ—Å—Ç...")
    time.sleep(3)

    for i, (x, y) in enumerate(coordinates):
        print(f"\nüéØ –ü—Ä–µ–¥–º–µ—Ç {i + 1}/{len(coordinates)}: ({x}, {y})")

        # –¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è
        current_x, current_y = pyautogui.position()
        print(f"üîß –¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è: ({current_x}, {current_y})")

        # –ü–µ—Ä–µ–º–µ—â–∞–µ–º—Å—è
        print(f"üîß –ü–µ—Ä–µ–º–µ—â–∞–µ–º—Å—è –∫ –ø—Ä–µ–¥–º–µ—Ç—É...")
        pyautogui.moveTo(x, y, duration=0.5)

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω–µ—á–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
        final_x, final_y = pyautogui.position()
        distance = (final_x - x) ** 2 + (final_y - y) ** 2
        print(f"üîß –ö–æ–Ω–µ—á–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è: ({final_x}, {final_y})")
        print(f"üîß –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ —Ü–µ–ª–∏: {distance:.1f} px")

        # –ñ–¥–µ–º –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
        print(f"üîß –ü–∞—É–∑–∞ 3 —Å–µ–∫—É–Ω–¥—ã...")
        time.sleep(3)

    print("\n" + "=" * 50)
    print("‚úÖ –¢–ï–°–¢ –ó–ê–í–ï–†–®–ï–ù")


def test_scan_region():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –æ–±–ª–∞—Å—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è"""
    print("\nüîç –¢–ï–°–¢ –û–ë–õ–ê–°–¢–ò –°–ö–ê–ù–ò–†–û–í–ê–ù–ò–Ø")
    print("=" * 50)

    # –û–±–ª–∞—Å—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
    scan_region = [2254, 478, 453, 88]
    x, y, w, h = scan_region

    print(f"üîß –û–±–ª–∞—Å—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: X={x}, Y={y}, –®={w}, –í={h}")
    print(f"üîß –¶–µ–Ω—Ç—Ä –æ–±–ª–∞—Å—Ç–∏: ({x + w // 2}, {y + h // 2})")

    print("üîß –ü–µ—Ä–µ–º–µ—â–∞–µ–º—Å—è –∫ —Ü–µ–Ω—Ç—Ä—É –æ–±–ª–∞—Å—Ç–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è...")
    pyautogui.moveTo(x + w // 2, y + h // 2, duration=0.5)

    print("üîß –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –æ–±–ª–∞—Å—Ç–∏...")
    screenshot = pyautogui.screenshot(region=(x, y, w, h))
    screenshot.save('debug_scan_region.png')
    print("‚úÖ –°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: debug_scan_region.png")

    time.sleep(2)


def test_specific_positions():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞"""
    print("\nüéØ –¢–ï–°–¢ –°–ü–ï–¶–ò–§–ò–ß–ï–°–ö–ò–• –ü–û–ó–ò–¶–ò–ô")
    print("=" * 50)

    positions = {
        "currency_position": [2207, 318],
        "item_position": [2483, 635],
        "stash_tab_position": [2206, 129],
        "first_item_position": [1984, 247]
    }

    for name, (x, y) in positions.items():
        print(f"\nüîß {name}: ({x}, {y})")
        pyautogui.moveTo(x, y, duration=0.5)
        time.sleep(2)


if __name__ == "__main__":
    try:
        print("üöÄ –ó–ê–ü–£–°–ö –¢–ï–°–¢–ê –ö–û–û–†–î–ò–ù–ê–¢ POE CRAFT BOT")
        print("‚ö†Ô∏è  –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∏–≥—Ä–∞ PoE –æ—Ç–∫—Ä—ã—Ç–∞ –∏ –∞–∫—Ç–∏–≤–Ω–∞!")

        # –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã
        test_all_coordinates()
        test_scan_region()
        test_specific_positions()

        print("\nüéâ –í–°–ï –¢–ï–°–¢–´ –ó–ê–í–ï–†–®–ï–ù–´!")
        print("üìä –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:")
        print("   - –ü–æ–ø–∞–¥–∞–µ—Ç –ª–∏ –º—ã—à—å –≤ —Ü–µ–Ω—Ç—Ä—ã –ø—Ä–µ–¥–º–µ—Ç–æ–≤?")
        print("   - –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –ª–∏ –æ–±–ª–∞—Å—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–¥—ã?")
        print("   - –°–∫—Ä–∏–Ω—à–æ—Ç debug_scan_region.png")

    except KeyboardInterrupt:
        print("\nüõë –¢–ï–°–¢ –ü–†–ï–†–í–ê–ù –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ú")
    except Exception as e:
        print(f"\n‚ùå –û–®–ò–ë–ö–ê: {e}")